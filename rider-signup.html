<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>YANA — Rider Sign Up</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="card">
    <h1>Rider Sign Up</h1>
    <div class="muted">Sign up with Google. Your name and email will be auto-filled.</div>

    <!-- Google Sign Up Button -->
    <button class="btn" id="googleSignupBtn">Sign Up with Google</button>

    <!-- Link to Sign In -->
    <button class="btn secondary" onclick="window.location.href='rider-signin.html'">
      Already registered? Sign In
    </button>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script> <!-- contains db + auth -->

  <script>
    const provider = new firebase.auth.GoogleAuthProvider();

    document.getElementById("googleSignupBtn").addEventListener("click", () => {
      console.log("✅ Google button clicked"); // Debug log

      auth.signInWithPopup(provider)
        .then(async (result) => {
          const user = result.user;
          const email = user.email;
          const name = user.displayName;

          console.log("✅ Google Sign-In Success:", email);

          const ref = db.collection("users").doc(email);
          const snap = await ref.get();

          if (snap.exists) {
            alert("Rider already exists. Please sign in.");
            window.location.href = "rider-signin.html";
            return;
          }

          // Create new rider record
          await ref.set({
            name,
            email,
            status: "pending",
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          alert("Registration successful. Await admin approval.");
          window.location.href = "homepage.html";
        })
        .catch(err => {
          console.error("❌ Google Sign-In Error:", err);
          alert(err.message);
        });
    });
  </script>
</body>
</html>
