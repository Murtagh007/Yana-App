<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>YANA ‚Äî Manage Locations</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <h2>üìç Manage Locations</h2>
    <div class="profile">
      <div class="profile-pic">A</div>
      <div class="dropdown">
        <button id="logoutBtn">Logout</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Add Location Form -->
    <h2>Add Location</h2>
    <form id="locationForm" class="panel" style="padding:15px">
      <input type="text" id="locName" placeholder="Location Name" required class="input"/>
      <input type="number" id="lat" placeholder="Latitude" step="any" required class="input"/>
      <input type="number" id="lng" placeholder="Longitude" step="any" required class="input"/>
      <input type="number" id="radius" placeholder="Radius (meters)" required class="input"/>
      <button type="submit" class="menu-btn ripple" style="margin-top:10px">
        <i class="fas fa-plus-circle"></i> Save
      </button>
    </form>

    <!-- Location List -->
    <h2>Existing Locations</h2>
    <div id="locationsList" class="panel" style="padding:15px"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    // Auth check
    auth.onAuthStateChanged(async user => {
      if (!user) return location.href="admin-signin.html";
      const doc = await db.collection("users").doc(user.email).get();
      if (!doc.exists || doc.data().role !== "admin") {
        alert("‚ùå Not an admin."); return location.href="index.html";
      }
    });

    document.getElementById("logoutBtn").onclick = () => auth.signOut();

    const form = document.getElementById("locationForm");
    const listDiv = document.getElementById("locationsList");

    form.onsubmit = async (e) => {
      e.preventDefault();
      const name = document.getElementById("locName").value.trim();
      const lat = parseFloat(document.getElementById("lat").value);
      const lng = parseFloat(document.getElementById("lng").value);
      const radius = parseInt(document.getElementById("radius").value);

      try {
        await db.collection("locations").add({
          name, lat, lng, radius,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        form.reset();
        alert("‚úÖ Location added");
      } catch (err) {
        alert("‚ùå Error: " + err.message);
      }
    };

    // Realtime list
    db.collection("locations").orderBy("createdAt","desc").onSnapshot(snap => {
      listDiv.innerHTML = "";
      if (snap.empty) {
        listDiv.innerHTML = "<p>No locations added yet.</p>";
        return;
      }
      snap.forEach(doc => {
        const loc = doc.data();
        const item = document.createElement("div");
        item.className = "chip";
        item.innerHTML = `<b>${loc.name}</b> ‚Äî [${loc.lat}, ${loc.lng}] ‚Äî ${loc.radius}m`;
        listDiv.appendChild(item);
      });
    });
  </script>
</body>
</html>
