<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>YANA — Pending Rider Approval</title>
<link rel="stylesheet" href="styles.css">
<style>
  .search-bar {
    margin: 12px 0;
    display: flex;
    gap: 8px;
  }
  .search-bar input {
    flex: 1;
    padding: 8px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--bg2);
    color: var(--text);
  }
  .grid-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 12px;
  }
  .rider-card {
    background: var(--card);
    padding: 12px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    transition: var(--transition);
  }
  .rider-card:hover { box-shadow: 0 0 12px var(--action); border-color: var(--action); }
  .rider-card h3 { margin: 0 0 8px; font-size: 16px; color: var(--action); }
  .rider-card p { margin: 2px 0; font-size: 13px; }
  .rider-card label { font-size: 12px; display: block; margin-top: 6px; }
  .rider-card select {
    width: 100%;
    padding: 6px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    background: var(--bg2);
    color: var(--text);
  }
  #submitBtn { margin-top: 16px; }
</style>
</head>
<body>
<div class="navbar">
  <h2>⚡ YANA Admin</h2>
  <div class="profile">
    <div class="profile-pic">A</div>
    <div class="dropdown">
      <button onclick="location.href='admin-dashboard.html'">⬅ Dashboard</button>
      <button id="logoutBtn">Logout</button>
    </div>
  </div>
</div>

<div class="container">
  <h2>Pending Rider Approval</h2>
  <p class="muted">Review riders awaiting approval. Choose Approve, Reject, or No Action.</p>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search by name, email, or vendor...">
  </div>

  <div class="grid-cards" id="ridersGrid"></div>

  <button class="menu-btn ripple" id="submitBtn"><i class="fas fa-check"></i> Submit Changes</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="firebase-config.js"></script>

<script>
  let allRiders = [];
  const ridersGrid = document.getElementById("ridersGrid");

  // Admin auth check
  auth.onAuthStateChanged(async user => {
    if (!user) return location.href="admin-signin.html";
    const doc = await db.collection("users").doc(user.email).get();
    if (!doc.exists || doc.data().role !== "admin") {
      alert("❌ Not an admin."); 
      return location.href="index.html";
    }
    document.querySelector(".profile-pic").innerText = (user.email[0] || "A").toUpperCase();
  });

  document.getElementById("logoutBtn").onclick = () => auth.signOut();

  function renderRiders(riders) {
    ridersGrid.innerHTML = "";
    riders.forEach(d => {
      const card = document.createElement("div");
      card.className = "rider-card";
      card.innerHTML = `
        <h3>${d.name || ""}</h3>
        <p><b>Email:</b> ${d.email}</p>
        <p><b>Phone:</b> ${d.phone || ""}</p>
        <p><b>Vendor:</b> ${d.vendor || ""}</p>
        <p><b>Partners:</b> ${(d.partners||[]).join(", ")}</p>
        <label>Action:</label>
        <select data-id="${d.email}">
          <option value="none" selected>No Action</option>
          <option value="approved">Approve</option>
          <option value="rejected">Reject</option>
        </select>
      `;
      ridersGrid.appendChild(card);
    });
  }

  // Load pending riders
  db.collection("users")
    .where("status","==","pending")
    .onSnapshot(snap => {
      allRiders = snap.docs.map(d => ({email:d.id,...d.data()}));
      renderRiders(allRiders);
    });

  // Search filter
  document.getElementById("searchInput").addEventListener("input", e => {
    const term = e.target.value.toLowerCase();
    renderRiders(allRiders.filter(r =>
      (r.name||"").toLowerCase().includes(term) ||
      (r.email||"").toLowerCase().includes(term) ||
      (r.vendor||"").toLowerCase().includes(term)
    ));
  });

  // Submit bulk updates
  document.getElementById("submitBtn").addEventListener("click", async () => {
    const updates = [];
    document.querySelectorAll("select[data-id]").forEach(sel => {
      const email = sel.dataset.id;
      const action = sel.value;
      if(action!=="none") updates.push(db.collection("users").doc(email).update({status:action}));
    });
    if(updates.length===0){ alert("ℹ No actions selected."); return; }
    await Promise.all(updates);
    alert("✅ Changes applied!");
  });
</script>
</body>
</html>
