<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>YANA Seeder</title>
  <style>
    body { font-family: monospace; background:#111; color:#0f0; padding:20px; }
    pre { background:#000; padding:15px; border-radius:8px; }
    button { padding:10px 15px; background:#0f0; border:none; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>
  <h2>üöÄ YANA Seeder</h2>
  <p>Seeds <code>scooties</code> and <code>batteries</code> masterlist into Firestore.</p>
  <button id="startBtn">Start Seeding</button>

  <pre id="log"></pre>

  <!-- Firebase v8 SDKs -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    const logBox = document.getElementById("log");
    const log = msg => logBox.textContent += msg + "\n";

    document.getElementById("startBtn").addEventListener("click", async () => {
      log("üîë Signing in anonymously (admin-only rules required)...");
      try {
        await firebase.auth().signInAnonymously();
      } catch(err){
        log("‚ùå Auth failed: " + err.message);
        return;
      }

      const db = firebase.firestore();

      async function seedCollection(filename, collectionName) {
        log(`\nüìÇ Seeding ${collectionName} from ${filename}...`);
        try {
          const res = await fetch(filename);
          if(!res.ok) throw new Error(`Failed to fetch ${filename}`);
          const text = await res.text();
          const ids = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);

          let success = 0, fail = 0;
          for(const id of ids){
            try {
              await db.collection(collectionName).doc(id).set({
                state: "active",
                status: "returned",
                lastAssignedTo: null,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
              }, { merge: true });
              log(`‚úÖ Added ${collectionName.slice(0,-1)}: ${id}`);
              success++;
            } catch(err){
              log(`‚ùå Failed ${id}: ${err.message}`);
              fail++;
            }
          }
          log(`\n‚úîÔ∏è Completed ${collectionName}. Success: ${success}, Failed: ${fail}`);
        } catch(err){
          log(`‚ùå Seeding ${collectionName} failed: ${err.message}`);
        }
      }

      await seedCollection("scootyid.txt", "scooty_master");
await seedCollection("batteryid.txt", "battery_master");


      log("\nüéâ Seeding completed.");
    });
  </script>
</body>
</html>
