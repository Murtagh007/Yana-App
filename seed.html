<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Seed Master IDs</title>
</head>
<body style="font-family:system-ui;padding:20px;">
  <h1>🚀 Seed Master IDs</h1>
  <p>This will upload <b>scootyid.txt</b> and <b>batteryid.txt</b> into Firestore.</p>
  <button id="seedBtn">Start Seeding</button>
  <pre id="output"></pre>

  <!-- Firebase v8 SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    const output = document.getElementById('output');
    const log = msg => output.textContent += msg + "\n";

    async function seedCollection(fileUrl, collectionName) {
      log(`📂 Reading ${fileUrl}...`);
      const response = await fetch(fileUrl);
      if (!response.ok) throw new Error(`Failed to fetch ${fileUrl}`);
      const text = await response.text();
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l);

      for (const id of lines) {
        try {
          await db.collection(collectionName).doc(id).set({
            id,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          log(`✅ Added ${id} to ${collectionName}`);
        } catch (err) {
          log(`❌ Error adding ${id}: ${err.message}`);
        }
      }
    }

    document.getElementById('seedBtn').addEventListener('click', async () => {
      log("🔑 Signing in anonymously (needs admin rules to seed)...");

      try {
        await auth.signInAnonymously();
        log("Signed in, starting seeding...");

        await seedCollection('scootyid.txt', 'scootyMaster');
        await seedCollection('batteryid.txt', 'batteryMaster');

        log("🎉 Seeding complete!");
      } catch (err) {
        log("❌ Seeding failed: " + err.message);
      }
    });
  </script>
</body>
</html>

